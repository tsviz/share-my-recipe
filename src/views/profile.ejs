<%- include('partials/header') %>

<style>
    .profile-header {
        background-image: url('https://images.unsplash.com/photo-1547592180-85f173990554?auto=format&fit=crop&w=1500&q=80');
        background-size: cover;
        background-position: center;
        height: 200px;
        position: relative;
        border-radius: 1rem;
        margin-bottom: 60px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    }
    .profile-img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid #fff;
        position: absolute;
        bottom: -60px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        object-fit: cover;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    .profile-info {
        text-align: center;
        padding-top: 70px;
        color: #333;
    }
    .recipe-card {
        border-radius: 1rem;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        height: 100%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        background-color: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
    }
    .recipe-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    .recipe-img {
        height: 180px;
        object-fit: cover;
    }
    .stats-container {
        background-color: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 1rem;
        box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
    .stat-item {
        text-align: center;
    }
    .stat-value {
        font-size: 1.75rem;
        font-weight: bold;
        color: #ff8c00;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
    }
    .stat-label {
        color: #6c757d;
        font-size: 0.9rem;
        font-weight: 500;
    }
    .recipe-badge {
        position: absolute;
        top: 10px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.95);
        border-radius: 1rem;
        padding: 0.25rem 0.75rem;
        font-size: 0.8rem;
        font-weight: bold;
        color: #ff7043;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .main-container {
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        position: relative;
        z-index: 1;
    }
    .section-title {
        color: #ff7043;
        text-shadow: 1px 1px 4px rgba(255, 255, 255, 0.8);
        font-weight: bold;
        margin-bottom: 1.5rem;
    }
    .profile-username {
        color: #ff7043;
        text-shadow: 1px 1px 4px rgba(255, 255, 255, 0.8);
        font-weight: bold;
    }
    .empty-state {
        background-color: rgba(255, 248, 225, 0.9);
        border: 2px dashed #ffb347;
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        margin: 1rem 0;
    }
</style>

<div class="container mt-4 mb-5">
    <div class="main-container">
        <!-- Profile Header -->
        <div class="profile-header">
            <% if (user.profile_image) { %>
                <img src="/users/<%= user.id %>/profile-image" alt="<%= user.username %>" class="profile-img">
            <% } else { %>
                <div class="profile-img d-flex align-items-center justify-content-center">
                    <i class="bi bi-person-fill" style="font-size: 3rem; color: #ccc;"></i>
                </div>
            <% } %>
        </div>
        
        <!-- Profile Info -->
        <div class="profile-info mb-4">
            <h2 class="profile-username"><%= user.username %></h2>
            <% if (user.bio) { %>
                <p class="text-muted"><%= user.bio %></p>
            <% } else { %>
                <p class="text-muted">No bio provided</p>
            <% } %>
            <p><small class="text-muted">Member since <%= new Date(user.created_at).toLocaleDateString() %></small></p>
            
            <% if (isOwnProfile) { %>
                <div class="mt-3">
                    <a href="/profile/edit" class="btn btn-outline-main btn-sm">
                        <i class="bi bi-pencil"></i> Edit Profile
                    </a>
                    <a href="/favorites" class="btn btn-outline-danger btn-sm ms-2">
                        <i class="bi bi-heart-fill"></i> View Favorites
                    </a>
                    <a href="/dashboard" class="btn btn-main btn-sm ms-2">
                        <i class="bi bi-speedometer2"></i> Go to Dashboard
                    </a>
                </div>
            <% } %>
        </div>
        
        <!-- User Stats -->
        <div class="stats-container mb-4">
            <div class="row">
                <div class="col-4 stat-item">
                    <div class="stat-value"><%= recipes.length %></div>
                    <div class="stat-label">RECIPES</div>
                </div>
                <div class="col-4 stat-item">
                    <div class="stat-value"><%= favoriteCount || 0 %></div>
                    <div class="stat-label">FAVORITES</div>
                </div>
                <div class="col-4 stat-item">
                    <div class="stat-value"><%= viewCount || 0 %></div>
                    <div class="stat-label">RECIPE VIEWS</div>
                </div>
            </div>
        </div>
        
        <!-- User's Recipes -->
        <h3 class="section-title"><i class="bi bi-collection"></i> <%= user.username %>'s Recipes</h3>
        
        <% if (recipes.length === 0) { %>
            <div class="empty-state">
                <i class="bi bi-journal-plus" style="font-size: 3rem; color: #ffb347; margin-bottom: 1rem;"></i>
                <h5 style="color: #ff7043;">No recipes shared yet!</h5>
                <p class="text-muted">Start your culinary journey by sharing your first recipe</p>
                <% if (isOwnProfile) { %>
                    <a href="/recipes/new" class="btn btn-main">
                        <i class="bi bi-plus-circle"></i> Create Your First Recipe
                    </a>
                <% } %>
            </div>
        <% } else { %>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <% recipes.forEach(recipe => { %>
                    <div class="col">
                        <div class="card recipe-card h-100">
                            <div class="position-relative">
                                <img src="https://picsum.photos/300/200?random=<%= recipe.id %>" class="card-img-top recipe-img" alt="<%= recipe.title %>" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZTllY2VmIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IiM2NjY2NjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiI+8J+NsSDwnZCR4oCczqnOsSBGb29kPC90ZXh0Pjwvc3ZnPg=='; this.onerror=null;">
                                <% if (recipe.category_id) { %>
                                    <div class="recipe-badge"><%= recipe.category_name || 'Uncategorized' %></div>
                                <% } %>
                            </div>
                            <div class="card-body">
                                <h5 class="card-title text-primary"><%= recipe.title %></h5>
                                <p class="card-text text-muted"><%= recipe.description ? recipe.description.substring(0, 100) + '...' : 'No description provided.' %></p>
                            </div>
                            <div class="card-footer bg-transparent border-top-0">
                                <a href="/recipes/<%= recipe.id %>?page=dashboard" class="btn btn-outline-main btn-sm">
                                    <i class="bi bi-eye"></i> View Recipe
                                </a>
                                <% if (isOwnProfile) { %>
                                    <a href="/recipes/edit/<%= recipe.id %>" class="btn btn-outline-secondary btn-sm ms-1">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } %>
        
        <div class="text-center mt-4">
            <a href="/" class="btn btn-outline-secondary">
                <i class="bi bi-house"></i> Back to Home
            </a>
            <% if (isOwnProfile) { %>
                <a href="/dashboard" class="btn btn-main ms-2">
                    <i class="bi bi-speedometer2"></i> Dashboard
                </a>
            <% } %>
        </div>
    </div>
</div>

<%- include('partials/footer') %>