<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="1" author="system">
        <createTable tableName="users">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="username" type="VARCHAR(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints unique="true" nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="recipes">
            <column name="id" type="UUID" defaultValueComputed="gen_random_uuid()">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT"/>
            <column name="user_id" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="recipes" baseColumnNames="user_id"
                                 referencedTableName="users" referencedColumnNames="id"
                                 constraintName="fk_recipes_user_id"/>

        <createTable tableName="ingredients">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="recipe_ingredients">
            <column name="recipe_id" type="UUID">
                <constraints nullable="false"/>
            </column>
            <column name="ingredient_id" type="UUID">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint baseTableName="recipe_ingredients" baseColumnNames="recipe_id"
                                 referencedTableName="recipes" referencedColumnNames="id"
                                 constraintName="fk_recipe_ingredients_recipe_id"/>

        <addForeignKeyConstraint baseTableName="recipe_ingredients" baseColumnNames="ingredient_id"
                                 referencedTableName="ingredients" referencedColumnNames="id"
                                 constraintName="fk_recipe_ingredients_ingredient_id"/>
    </changeSet>

    <changeSet id="2" author="system">
        <createTable tableName="categories">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints unique="true" nullable="false"/>
            </column>
        </createTable>

        <addColumn tableName="recipes">
            <column name="category_id" type="UUID">
                <constraints nullable="true"/>
            </column>
        </addColumn>

        <addForeignKeyConstraint baseTableName="recipes" baseColumnNames="category_id"
                                 referencedTableName="categories" referencedColumnNames="id"
                                 constraintName="fk_recipes_category_id"/>
    </changeSet>

    <changeSet id="4" author="system">
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440000"/>
            <column name="username" value="user1"/>
            <column name="email" value="user1@example.com"/>
            <column name="password" value="password1"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440001"/>
            <column name="username" value="user2"/>
            <column name="email" value="user2@example.com"/>
            <column name="password" value="password2"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440002"/>
            <column name="username" value="user3"/>
            <column name="email" value="user3@example.com"/>
            <column name="password" value="password3"/>
        </insert>
        <!-- Add more users as needed to match the user_id values in recipes_data.csv -->
    </changeSet>

    <changeSet id="5" author="system">
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440003"/>
            <column name="username" value="user4"/>
            <column name="email" value="user4@example.com"/>
            <column name="password" value="password4"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440004"/>
            <column name="username" value="user5"/>
            <column name="email" value="user5@example.com"/>
            <column name="password" value="password5"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440005"/>
            <column name="username" value="user6"/>
            <column name="email" value="user6@example.com"/>
            <column name="password" value="password6"/>
        </insert>
        <!-- Add more users as needed to match the user_id values in recipes_data.csv -->
    </changeSet>

    <changeSet id="6" author="system">
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440006"/>
            <column name="username" value="user7"/>
            <column name="email" value="user7@example.com"/>
            <column name="password" value="password7"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440007"/>
            <column name="username" value="user8"/>
            <column name="email" value="user8@example.com"/>
            <column name="password" value="password8"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440008"/>
            <column name="username" value="user9"/>
            <column name="email" value="user9@example.com"/>
            <column name="password" value="password9"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440009"/>
            <column name="username" value="user10"/>
            <column name="email" value="user10@example.com"/>
            <column name="password" value="password10"/>
        </insert>
        <!-- Add more users as needed to match the user_id values in recipes_data.csv -->
    </changeSet>

    <changeSet id="7" author="system">
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440010"/>
            <column name="username" value="user11"/>
            <column name="email" value="user11@example.com"/>
            <column name="password" value="password11"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440011"/>
            <column name="username" value="user12"/>
            <column name="email" value="user12@example.com"/>
            <column name="password" value="password12"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440012"/>
            <column name="username" value="user13"/>
            <column name="email" value="user13@example.com"/>
            <column name="password" value="password13"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440013"/>
            <column name="username" value="user14"/>
            <column name="email" value="user14@example.com"/>
            <column name="password" value="password14"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440014"/>
            <column name="username" value="user15"/>
            <column name="email" value="user15@example.com"/>
            <column name="password" value="password15"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440015"/>
            <column name="username" value="user16"/>
            <column name="email" value="user16@example.com"/>
            <column name="password" value="password16"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440016"/>
            <column name="username" value="user17"/>
            <column name="email" value="user17@example.com"/>
            <column name="password" value="password17"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440017"/>
            <column name="username" value="user18"/>
            <column name="email" value="user18@example.com"/>
            <column name="password" value="password18"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440018"/>
            <column name="username" value="user19"/>
            <column name="email" value="user19@example.com"/>
            <column name="password" value="password19"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440019"/>
            <column name="username" value="user20"/>
            <column name="email" value="user20@example.com"/>
            <column name="password" value="password20"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440020"/>
            <column name="username" value="user21"/>
            <column name="email" value="user21@example.com"/>
            <column name="password" value="password21"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440021"/>
            <column name="username" value="user22"/>
            <column name="email" value="user22@example.com"/>
            <column name="password" value="password22"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440022"/>
            <column name="username" value="user23"/>
            <column name="email" value="user23@example.com"/>
            <column name="password" value="password23"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440023"/>
            <column name="username" value="user24"/>
            <column name="email" value="user24@example.com"/>
            <column name="password" value="password24"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440024"/>
            <column name="username" value="user25"/>
            <column name="email" value="user25@example.com"/>
            <column name="password" value="password25"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440025"/>
            <column name="username" value="user26"/>
            <column name="email" value="user26@example.com"/>
            <column name="password" value="password26"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440026"/>
            <column name="username" value="user27"/>
            <column name="email" value="user27@example.com"/>
            <column name="password" value="password27"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440027"/>
            <column name="username" value="user28"/>
            <column name="email" value="user28@example.com"/>
            <column name="password" value="password28"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440028"/>
            <column name="username" value="user29"/>
            <column name="email" value="user29@example.com"/>
            <column name="password" value="password29"/>
        </insert>
        <insert tableName="users">
            <column name="id" value="550e8400-e29b-41d4-a716-446655440029"/>
            <column name="username" value="user30"/>
            <column name="email" value="user30@example.com"/>
            <column name="password" value="password30"/>
        </insert>
    </changeSet>

    <changeSet id="3" author="system" runOnChange="true">
        <loadData file="recipes_data.csv" tableName="recipes" separator=","/>
    </changeSet>

    <changeSet id="9" author="system" runOnChange="true">
        <loadData file="ingredients_data.csv" tableName="ingredients" separator=","/>
        <loadData file="recipe_ingredients_data.csv" tableName="recipe_ingredients" separator=","/>
    </changeSet>

    <!-- Add instructions column to recipes table -->
    <changeSet id="10" author="system">
        <addColumn tableName="recipes">
            <column name="instructions" type="TEXT"/>
        </addColumn>
    </changeSet>

    <!-- Load instructions data from CSV -->
    <changeSet id="11" author="system" runOnChange="true">
        <loadUpdateData file="recipe_instructions_data.csv" tableName="recipes" separator=","
            primaryKey="id"/>
    </changeSet>

</databaseChangeLog>